{% extends "base.html" %}

{% block title %}ターゲットの編集{% endblock title %}

{% block content %}
    <h3 class="page-header">ターゲットの編集</h3>
    <div class="container">

    {% if msg %}
        {{ msg }}<br><br>
    {% endif %}


    {% if target_id %}
    <form id="uploadForm" action="{% url 'hlar:target_mod' target_id=target_id %}" enctype="multipart/form-data" method="post" class="form-horizontal" role="form">
    {% else %}
    <form id="uploadForm" action="{% url 'hlar:target_add' %}" method="post" enctype="multipart/form-data" class="form-horizontal" role="form">
    {% endif %}
      {% csrf_token %}

      {# {{ form|bootstrap_horizontal }} #}
      {# {{ form }} #}

        <div class="form-group">
            <label>TARGET IMAGE</label>
            <input type="file" name="target" class="form-control">
            <input type="hidden" name="target_file_name" value="">
        </div>

        <div class="form-group">
            <label>CONTENTS</label>
            <input type="file" name="contents" class="form-control">
            <input type="hidden" name="contents_file_name" value="">
        </div>

        <div class="form-group">
            <label>NAME</label>
            <input type="text" name="target_name" class="form-control">
        </div>


      <div class="form-group">
        <!-- <div class="col-sm-offset-2 col-sm-10"> -->
        <div class="col-sm-10">
          <button type="submit" class="btn btn-primary">送信</button>
        </div>
      </div>
    </form>
    <a href="{% url 'hlar:target_list' %}" class="btn btn-default btn-sm">戻る</a>

    </div>

<script>
$(function() {

    $("input[name='target']").change(function(){

        var formData = new FormData($('#uploadForm')[0]);
        formData.append('other_data', 999);

        $.ajax({
             url: '../upload/',
             type: 'post',
             data: formData,
             processData: false,
             contentType: false,
             timeout: 10000
         }).done(function (json, statusText, jqXHR) {
            console.log('done');
            ret = JSON.parse(json);
            $("input[name='target_file_name']").val(ret.filename);

         }).fail(function (jqXHR, statusText, errorThrown) {
             console.log('fail');
         }).then(function () {
            //$('#uploadForm').remove();
         });
    });
});
</script>


{% endblock content %}
